<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Medical Shop Automation Software</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.2/css/buttons.dataTables.min.css">
</head>
<body>
    <!-- Header Section -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">
                    <h1>MedShop</h1>
                </div>
                <div class="menu-toggle">
                    <i class="fas fa-bars"></i>
                </div>
                <ul class="nav-menu">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="inventory.html">Inventory</a></li>
                    <li><a href="sales.html">Sales</a></li>
                    <li><a href="prescriptions.html">Prescriptions</a></li>
                    <li><a href="suppliers.html">Suppliers</a></li>
                    <li><a href="reports.html" class="active">Reports</a></li>
                </ul>
                <div class="user-actions">
                    <div class="user-profile">
                        <img src="/api/placeholder/40/40" alt="User Profile">
                        <span>Admin</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="reports-main">
        <div class="container">
            <div class="reports-header">
                <h2><i class="fas fa-chart-bar"></i> Reports & Analytics</h2>
                <div class="reports-actions">
                    <button class="btn primary-btn" id="generateReportBtn">
                        <i class="fas fa-plus"></i> Generate Report
                    </button>
                    <button class="btn secondary-btn" id="exportAllBtn">
                        <i class="fas fa-file-export"></i> Export All
                    </button>
                </div>
            </div>

            <!-- Report Filters -->
            <div class="reports-filters">
                <div class="filter-group">
                    <label for="reportType">Report Type:</label>
                    <select id="reportType">
                        <option value="">All Reports</option>
                        <option value="sales">Sales Reports</option>
                        <option value="inventory">Inventory Reports</option>
                        <option value="expiry">Expiry Reports</option>
                        <option value="supplier">Supplier Reports</option>
                        <option value="prescription">Prescription Reports</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="dateRange">Date Range:</label>
                    <select id="dateRange">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>
                <div class="filter-group custom-date" style="display: none;">
                    <label for="customFrom">From:</label>
                    <input type="date" id="customFrom">
                </div>
                <div class="filter-group custom-date" style="display: none;">
                    <label for="customTo">To:</label>
                    <input type="date" id="customTo">
                </div>
                <button class="btn primary-btn" id="applyFiltersBtn">Apply Filters</button>
                <button class="btn secondary-btn" id="resetFiltersBtn">Reset</button>
            </div>

            <!-- Reports Summary Cards -->
            <div class="reports-summary">
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-rupee-sign"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Total Revenue</h3>
                        <p class="count" id="totalRevenue">₹0</p>
                        <p class="subtext"><span id="revenueChange">0%</span> vs last period</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Total Sales</h3>
                        <p class="count" id="totalSales">0</p>
                        <p class="subtext"><span id="salesChange">0%</span> vs last period</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-pills"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Top Selling</h3>
                        <p class="count" id="topSelling">-</p>
                        <p class="subtext"><span id="topSellingQty">0</span> units sold</p>
                    </div>
                </div>
                <div class="summary-card">
                    <div class="summary-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="summary-content">
                        <h3>Prescriptions</h3>
                        <p class="count" id="totalPrescriptions">0</p>
                        <p class="subtext"><span id="prescriptionChange">0%</span> vs last period</p>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="reports-charts">
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Sales Trend</h3>
                        <select id="salesTrendPeriod">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="monthly" selected>Monthly</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="salesTrendChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Inventory Status</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="inventoryStatusChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Payment Methods</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="paymentMethodsChart"></canvas>
                    </div>
                </div>
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>Prescription Status</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="prescriptionStatusChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Reports Table -->
            <div class="reports-table-container">
                <table id="reportsTable" class="display">
                    <thead>
                        <tr>
                            <th>Report ID</th>
                            <th>Report Name</th>
                            <th>Type</th>
                            <th>Date Range</th>
                            <th>Generated On</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="reportsTableBody">
                        <!-- Data will be loaded dynamically -->
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <!-- Generate Report Modal -->
    <div class="modal" id="generateReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Generate New Report</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="reportForm">
                    <div class="form-group">
                        <label for="reportName">Report Name*</label>
                        <input type="text" id="reportName" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportCategory">Report Category*</label>
                        <select id="reportCategory" required>
                            <option value="">Select Category</option>
                            <option value="sales">Sales Report</option>
                            <option value="inventory">Inventory Report</option>
                            <option value="expiry">Expiry Report</option>
                            <option value="supplier">Supplier Report</option>
                            <option value="prescription">Prescription Report</option>
                            <option value="custom">Custom Report</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportPeriod">Time Period*</label>
                        <select id="reportPeriod" required>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month" selected>This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    
                    <div class="form-row custom-range" style="display: none;">
                        <div class="form-group">
                            <label for="reportFrom">From Date*</label>
                            <input type="date" id="reportFrom">
                        </div>
                        <div class="form-group">
                            <label for="reportTo">To Date*</label>
                            <input type="date" id="reportTo">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportFormat">Format*</label>
                        <select id="reportFormat" required>
                            <option value="pdf">PDF</option>
                            <option value="excel">Excel</option>
                            <option value="csv">CSV</option>
                            <option value="html">HTML</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="reportNotes">Notes</label>
                        <textarea id="reportNotes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn secondary-btn close-modal">Cancel</button>
                        <button type="submit" class="btn primary-btn">Generate Report</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- View Report Modal -->
    <div class="modal" id="viewReportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Report Details</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="report-details">
                    <div class="detail-row">
                        <span class="detail-label">Report ID:</span>
                        <span class="detail-value" id="view-reportId">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Report Name:</span>
                        <span class="detail-value" id="view-reportName">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Category:</span>
                        <span class="detail-value" id="view-reportCategory">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Date Range:</span>
                        <span class="detail-value" id="view-reportRange">-</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Generated On:</span>
                        <span class="detail-value" id="view-generatedOn">-</span>
                    </div>
                    <div class="detail-row full-width">
                        <span class="detail-label">Notes:</span>
                        <span class="detail-value" id="view-reportNotes">-</span>
                    </div>
                </div>
                
                <div class="report-preview">
                    <h4>Report Preview</h4>
                    <div class="preview-container">
                        <p>This is a preview of how the report would look when generated. Actual report may contain more detailed data.</p>
                        <div id="reportPreviewContent">
                            <!-- Report preview will be shown here -->
                        </div>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn primary-btn close-modal">Close</button>
                    <button type="button" class="btn secondary-btn" id="downloadReportBtn">
                        <i class="fas fa-download"></i> Download Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-about">
                    <h3>MedShop</h3>
                    <p>Advanced Medical Shop Automation Software designed to streamline pharmacy operations and enhance customer service.</p>
                    <div class="social-icons">
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                        <a href="#"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="features.html">Features</a></li>
                        <li><a href="pricing.html">Pricing</a></li>
                        <li><a href="contact.html">Contact</a></li>
                        <li><a href="about.html">About Us</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h3>Resources</h3>
                    <ul>
                        <li><a href="docs.html">Documentation</a></li>
                        <li><a href="tutorials.html">Tutorials</a></li>
                        <li><a href="blog.html">Blog</a></li>
                        <li><a href="support.html">Support</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer-contact">
                    <h3>Contact Us</h3>
                    <p><i class="fas fa-map-marker-alt"></i> NIT Rourkela, Odisha, India</p>
                    <p><i class="fas fa-phone"></i> +91 1234567890</p>
                    <p><i class="fas fa-envelope"></i> info@medshop.com</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Medical Shop Automation Software. All rights reserved.</p>
                <p>Developed by NIT Rourkela Team</p>
            </div>
        </div>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.2.2/js/buttons.print.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Sample data for reports
        let reports = [
            {
                id: "REP-2023-001",
                name: "Monthly Sales Report",
                type: "sales",
                dateRange: "June 2023",
                generatedOn: "2023-06-30",
                notes: "Includes all sales transactions for June 2023",
                format: "pdf"
            },
            {
                id: "REP-2023-002",
                name: "Inventory Stock Report",
                type: "inventory",
                dateRange: "As of 2023-06-30",
                generatedOn: "2023-06-30",
                notes: "Current stock levels and status",
                format: "excel"
            },
            {
                id: "REP-2023-003",
                name: "Prescription Analysis",
                type: "prescription",
                dateRange: "June 1-30, 2023",
                generatedOn: "2023-06-30",
                notes: "Analysis of prescription trends",
                format: "pdf"
            },
            {
                id: "REP-2023-004",
                name: "Supplier Performance",
                type: "supplier",
                dateRange: "Q2 2023",
                generatedOn: "2023-06-30",
                notes: "Supplier delivery times and order fulfillment",
                format: "csv"
            },
            {
                id: "REP-2023-005",
                name: "Expiry Alert Report",
                type: "expiry",
                dateRange: "Next 3 months",
                generatedOn: "2023-06-30",
                notes: "Medicines expiring in next 3 months",
                format: "pdf"
            }
        ];

        // Initialize DataTable and load data
        $(document).ready(function() {
            // Load reports into table
            loadReports();
            
            // Initialize DataTable with export buttons
            const table = $('#reportsTable').DataTable({
                responsive: true,
                dom: 'Bfrtip',
                buttons: [
                    'copy', 'csv', 'excel', 'pdf', 'print'
                ],
                order: [[4, 'desc']] // Sort by generated date descending
            });
            
            // Update summary cards
            updateSummaryCards();
            
            // Initialize charts
            initializeCharts();
            
            // Modal functionality
            const openModal = (modalId) => {
                document.getElementById(modalId).style.display = 'block';
                document.body.style.overflow = 'hidden';
            };
            
            const closeModal = (modalId) => {
                document.getElementById(modalId).style.display = 'none';
                document.body.style.overflow = 'auto';
            };
            
            // Event listeners for modals
            document.getElementById('generateReportBtn').addEventListener('click', () => {
                // Reset form
                document.getElementById('reportForm').reset();
                document.querySelector('.custom-range').style.display = 'none';
                openModal('generateReportModal');
            });
            
            document.getElementById('exportAllBtn').addEventListener('click', () => {
                // Trigger CSV export
                const table = $('#reportsTable').DataTable();
                table.button('.buttons-csv').trigger();
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(event) {
                if (event.target.classList.contains('modal')) {
                    closeModal(event.target.id);
                }
            });
            
            // Show/hide custom date range
            document.getElementById('dateRange').addEventListener('change', function() {
                const customDates = document.querySelectorAll('.custom-date');
                if (this.value === 'custom') {
                    customDates.forEach(el => el.style.display = 'block');
                } else {
                    customDates.forEach(el => el.style.display = 'none');
                }
            });
            
            document.getElementById('reportPeriod').addEventListener('change', function() {
                const customRange = document.querySelector('.custom-range');
                if (this.value === 'custom') {
                    customRange.style.display = 'flex';
                } else {
                    customRange.style.display = 'none';
                }
            });
            
            // Form submission for new report
            document.getElementById('reportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Generate new report ID
                const newReportId = 'REP-' + new Date().getFullYear() + '-' + String(reports.length + 1).padStart(3, '0');
                
                // Get date range
                let dateRange;
                const period = document.getElementById('reportPeriod').value;
                
                if (period === 'custom') {
                    const fromDate = document.getElementById('reportFrom').value;
                    const toDate = document.getElementById('reportTo').value;
                    dateRange = `${fromDate} to ${toDate}`;
                } else {
                    const today = new Date();
                    const options = { 
                        today: 'Today',
                        week: `Week ${getWeekNumber(today)} of ${today.getFullYear()}`,
                        month: new Intl.DateTimeFormat('en-US', { month: 'long', year: 'numeric' }).format(today),
                        quarter: `Q${Math.floor(today.getMonth() / 3) + 1} ${today.getFullYear()}`,
                        year: today.getFullYear().toString()
                    };
                    dateRange = options[period];
                }
                
                // Create new report object
                const newReport = {
                    id: newReportId,
                    name: document.getElementById('reportName').value,
                    type: document.getElementById('reportCategory').value,
                    dateRange: dateRange,
                    generatedOn: new Date().toISOString().split('T')[0],
                    notes: document.getElementById('reportNotes').value || '',
                    format: document.getElementById('reportFormat').value
                };
                
                // Add to reports array
                reports.push(newReport);
                
                // Reload table
                loadReports();
                
                // Close modal and reset form
                closeModal('generateReportModal');
                
                // Show success message
                alert(`Report generated successfully! Report ID: ${newReportId}`);
            });
            
            // Download report button
            document.getElementById('downloadReportBtn')?.addEventListener('click', function() {
                const reportId = document.getElementById('view-reportId').textContent;
                alert(`Download functionality for ${reportId} would be implemented here`);
            });
            
            // Apply filters
            document.getElementById('applyFiltersBtn').addEventListener('click', applyFilters);
            
            // Reset filters
            document.getElementById('resetFiltersBtn').addEventListener('click', resetFilters);
            
            // Mobile menu toggle
            document.querySelector('.menu-toggle').addEventListener('click', function() {
                document.querySelector('.nav-menu').classList.toggle('active');
            });
            
            // Close modal buttons
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    closeModal(modal.id);
                });
            });
        });
        
        // Load reports into the table
        function loadReports() {
            const tableBody = document.getElementById('reportsTableBody');
            tableBody.innerHTML = '';
            
            reports.forEach(report => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.name}</td>
                    <td>${formatReportType(report.type)}</td>
                    <td>${report.dateRange}</td>
                    <td>${report.generatedOn}</td>
                    <td>
                        <button class="action-btn view-btn" data-id="${report.id}"><i class="fas fa-eye"></i></button>
                        <button class="action-btn download-btn" data-id="${report.id}"><i class="fas fa-download"></i></button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to action buttons
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.getAttribute('data-id');
                    showReportDetails(reportId);
                    openModal('viewReportModal');
                });
            });
            
            document.querySelectorAll('.download-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const reportId = this.getAttribute('data-id');
                    alert(`Download functionality for ${reportId} would be implemented here`);
                });
            });
        }
        
        // Show report details in view modal
        function showReportDetails(reportId) {
            const report = reports.find(r => r.id === reportId);
            if (!report) return;
            
            document.getElementById('view-reportId').textContent = report.id;
            document.getElementById('view-reportName').textContent = report.name;
            document.getElementById('view-reportCategory').textContent = formatReportType(report.type);
            document.getElementById('view-reportRange').textContent = report.dateRange;
            document.getElementById('view-generatedOn').textContent = report.generatedOn;
            document.getElementById('view-reportNotes').textContent = report.notes || 'No notes available';
            
            // Load report preview
            const previewContent = document.getElementById('reportPreviewContent');
            previewContent.innerHTML = '';
            
            // Create a simple preview based on report type
            let previewHTML = '';
            
            switch(report.type) {
                case 'sales':
                    previewHTML = `
                        <h5>Sales Summary</h5>
                        <p>Total Sales: 125</p>
                        <p>Total Revenue: ₹24,560</p>
                        <p>Average Order Value: ₹196.48</p>
                        <p>Top Selling Item: Paracetamol 500mg (320 units)</p>
                    `;
                    break;
                case 'inventory':
                    previewHTML = `
                        <h5>Inventory Summary</h5>
                        <p>Total Items: 142</p>
                        <p>In Stock: 118</p>
                        <p>Low Stock: 18</p>
                        <p>Out of Stock: 6</p>
                    `;
                    break;
                case 'expiry':
                    previewHTML = `
                        <h5>Expiry Summary</h5>
                        <p>Items Expiring in 30 Days: 12</p>
                        <p>Items Expiring in 60 Days: 24</p>
                        <p>Items Expiring in 90 Days: 38</p>
                        <p>Total Value of Expiring Items: ₹8,450</p>
                    `;
                    break;
                case 'supplier':
                    previewHTML = `
                        <h5>Supplier Summary</h5>
                        <p>Total Suppliers: 8</p>
                        <p>Orders Placed: 24</p>
                        <p>Average Delivery Time: 3.2 days</p>
                        <p>Top Supplier: ABC Pharmaceuticals (12 orders)</p>
                    `;
                    break;
                case 'prescription':
                    previewHTML = `
                        <h5>Prescription Summary</h5>
                        <p>Total Prescriptions: 56</p>
                        <p>Filled: 42</p>
                        <p>Pending: 8</p>
                        <p>Rejected: 6</p>
                        <p>Most Prescribed: Amoxicillin 250mg (18 times)</p>
                    `;
                    break;
                default:
                    previewHTML = '<p>Custom report preview not available</p>';
            }
            
            previewContent.innerHTML = previewHTML;
        }
        
        // Update summary cards
        function updateSummaryCards() {
            // In a real app, these would come from API/data
            document.getElementById('totalRevenue').textContent = '₹24,560';
            document.getElementById('revenueChange').textContent = '+12%';
            document.getElementById('totalSales').textContent = '125';
            document.getElementById('salesChange').textContent = '+8%';
            document.getElementById('topSelling').textContent = 'Paracetamol 500mg';
            document.getElementById('topSellingQty').textContent = '320';
            document.getElementById('totalPrescriptions').textContent = '56';
            document.getElementById('prescriptionChange').textContent = '+15%';
        }
        
        // Initialize charts
        function initializeCharts() {
            // Sales Trend Chart
            const salesTrendCtx = document.getElementById('salesTrendChart').getContext('2d');
            const salesTrendChart = new Chart(salesTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Sales (₹)',
                        data: [18500, 19200, 21000, 22500, 23800, 24560],
                        backgroundColor: 'rgba(52, 152, 219, 0.2)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '₹' + context.raw.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return '₹' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Inventory Status Chart
            const inventoryStatusCtx = document.getElementById('inventoryStatusChart').getContext('2d');
            const inventoryStatusChart = new Chart(inventoryStatusCtx, {
                type: 'doughnut',
                data: {
                    labels: ['In Stock', 'Low Stock', 'Out of Stock', 'Expiring Soon'],
                    datasets: [{
                        data: [85, 32, 12, 18],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(243, 156, 18, 0.7)',
                            'rgba(231, 76, 60, 0.7)',
                            'rgba(155, 89, 182, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(155, 89, 182, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Payment Methods Chart
            const paymentMethodsCtx = document.getElementById('paymentMethodsChart').getContext('2d');
            const paymentMethodsChart = new Chart(paymentMethodsCtx, {
                type: 'bar',
                data: {
                    labels: ['Cash', 'Card', 'Online', 'UPI'],
                    datasets: [{
                        label: 'Payment Methods',
                        data: [85, 42, 28, 35],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.7)',
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(241, 196, 15, 0.7)'
                        ],
                        borderColor: [
                            'rgba(52, 152, 219, 1)',
                            'rgba(155, 89, 182, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(241, 196, 15, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Prescription Status Chart
            const prescriptionStatusCtx = document.getElementById('prescriptionStatusChart').getContext('2d');
            const prescriptionStatusChart = new Chart(prescriptionStatusCtx, {
                type: 'pie',
                data: {
                    labels: ['Filled', 'Pending', 'Rejected'],
                    datasets: [{
                        data: [42, 8, 6],
                        backgroundColor: [
                            'rgba(46, 204, 113, 0.7)',
                            'rgba(243, 156, 18, 0.7)',
                            'rgba(231, 76, 60, 0.7)'
                        ],
                        borderColor: [
                            'rgba(46, 204, 113, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(231, 76, 60, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        }
                    }
                }
            });
            
            // Update charts when period changes
            document.getElementById('salesTrendPeriod').addEventListener('change', function() {
                // In a real app, this would fetch new data based on period
                // For demo, we'll just update the labels
                let labels, data;
                
                switch(this.value) {
                    case 'daily':
                        labels = Array.from({length: 7}, (_, i) => {
                            const d = new Date();
                            d.setDate(d.getDate() - 6 + i);
                            return d.toLocaleDateString('en-US', { weekday: 'short' });
                        });
                        data = [3200, 3500, 3800, 4200, 3900, 4100, 4500];
                        break;
                    case 'weekly':
                        labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                        data = [18500, 19200, 21000, 22500];
                        break;
                    case 'monthly':
                        labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                        data = [18500, 19200, 21000, 22500, 23800, 24560];
                        break;
                }
                
                salesTrendChart.data.labels = labels;
                salesTrendChart.data.datasets[0].data = data;
                salesTrendChart.update();
            });
        }
        
        // Format report type for display
        function formatReportType(type) {
            const types = {
                'sales': 'Sales Report',
                'inventory': 'Inventory Report',
                'expiry': 'Expiry Report',
                'supplier': 'Supplier Report',
                'prescription': 'Prescription Report',
                'custom': 'Custom Report'
            };
            return types[type] || type;
        }
        
        // Get week number
        function getWeekNumber(d) {
            d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay() || 7));
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return weekNo;
        }
        
        // Apply filters to the table
        function applyFilters() {
            const reportType = document.getElementById('reportType').value;
            const dateRange = document.getElementById('dateRange').value;
            const customFrom = document.getElementById('customFrom').value;
            const customTo = document.getElementById('customTo').value;
            
            // Get DataTable instance